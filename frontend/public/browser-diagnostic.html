<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµè§ˆå™¨è¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .diagnostic-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid #ccc;
        }
        .status-success {
            background: #f0f9ff;
            border-left-color: #10b981;
            color: #065f46;
        }
        .status-error {
            background: #fef2f2;
            border-left-color: #ef4444;
            color: #991b1b;
        }
        .status-warning {
            background: #fffbeb;
            border-left-color: #f59e0b;
            color: #92400e;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #2563eb;
        }
        #console-output {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="diagnostic-container">
        <h1>ğŸ” iFlytek Spark é¢è¯•ç³»ç»Ÿ - æµè§ˆå™¨è¯Šæ–­å·¥å…·</h1>
        
        <div id="diagnostic-results">
            <h2>ç³»ç»Ÿæ£€æŸ¥ç»“æœ</h2>
            <div id="status-container"></div>
        </div>

        <div>
            <h2>æµ‹è¯•åŠŸèƒ½</h2>
            <button class="test-button" onclick="testVueApp()">æµ‹è¯•Vueåº”ç”¨</button>
            <button class="test-button" onclick="testElementPlus()">æµ‹è¯•Element Plus</button>
            <button class="test-button" onclick="testRouter()">æµ‹è¯•è·¯ç”±</button>
            <button class="test-button" onclick="testAPI()">æµ‹è¯•APIè¿æ¥</button>
            <button class="test-button" onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
        </div>

        <div id="console-output"></div>
    </div>

    <script>
        const statusContainer = document.getElementById('status-container');
        const consoleOutput = document.getElementById('console-output');

        function addStatus(message, type = 'success') {
            const div = document.createElement('div');
            div.className = `status-item status-${type}`;
            div.textContent = message;
            statusContainer.appendChild(div);
        }

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += `[${timestamp}] ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function clearConsole() {
            consoleOutput.innerHTML = '';
        }

        // åŸºç¡€ç¯å¢ƒæ£€æŸ¥
        function runBasicChecks() {
            log('ğŸ” å¼€å§‹åŸºç¡€ç¯å¢ƒæ£€æŸ¥...');

            // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
            if (typeof fetch !== 'undefined') {
                addStatus('âœ… Fetch API æ”¯æŒæ­£å¸¸', 'success');
                log('âœ… Fetch API æ”¯æŒæ­£å¸¸');
            } else {
                addStatus('âŒ Fetch API ä¸æ”¯æŒ', 'error');
                log('âŒ Fetch API ä¸æ”¯æŒ');
            }

            // æ£€æŸ¥ES6æ”¯æŒ
            try {
                eval('const test = () => {}');
                addStatus('âœ… ES6 ç®­å¤´å‡½æ•°æ”¯æŒæ­£å¸¸', 'success');
                log('âœ… ES6 ç®­å¤´å‡½æ•°æ”¯æŒæ­£å¸¸');
            } catch (e) {
                addStatus('âŒ ES6 æ”¯æŒæœ‰é—®é¢˜', 'error');
                log('âŒ ES6 æ”¯æŒæœ‰é—®é¢˜: ' + e.message);
            }

            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                addStatus('âœ… LocalStorage æ”¯æŒæ­£å¸¸', 'success');
                log('âœ… LocalStorage æ”¯æŒæ­£å¸¸');
            } catch (e) {
                addStatus('âŒ LocalStorage ä¸å¯ç”¨', 'error');
                log('âŒ LocalStorage ä¸å¯ç”¨: ' + e.message);
            }

            // æ£€æŸ¥æ§åˆ¶å°é”™è¯¯
            const originalError = console.error;
            let errorCount = 0;
            console.error = function(...args) {
                errorCount++;
                log('âŒ æ§åˆ¶å°é”™è¯¯: ' + args.join(' '));
                originalError.apply(console, args);
            };

            setTimeout(() => {
                if (errorCount === 0) {
                    addStatus('âœ… æ— æ§åˆ¶å°é”™è¯¯', 'success');
                    log('âœ… æ— æ§åˆ¶å°é”™è¯¯');
                } else {
                    addStatus(`âš ï¸ å‘ç° ${errorCount} ä¸ªæ§åˆ¶å°é”™è¯¯`, 'warning');
                    log(`âš ï¸ å‘ç° ${errorCount} ä¸ªæ§åˆ¶å°é”™è¯¯`);
                }
            }, 2000);
        }

        function testVueApp() {
            log('ğŸ§ª æµ‹è¯•Vueåº”ç”¨è¿æ¥...');
            
            fetch('http://localhost:5173/')
                .then(response => {
                    if (response.ok) {
                        addStatus('âœ… Vueåº”ç”¨æœåŠ¡å™¨å“åº”æ­£å¸¸', 'success');
                        log('âœ… Vueåº”ç”¨æœåŠ¡å™¨å“åº”æ­£å¸¸');
                        return response.text();
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                })
                .then(html => {
                    if (html.includes('Vue') || html.includes('app')) {
                        addStatus('âœ… Vueåº”ç”¨HTMLå†…å®¹æ­£å¸¸', 'success');
                        log('âœ… Vueåº”ç”¨HTMLå†…å®¹æ­£å¸¸');
                    } else {
                        addStatus('âš ï¸ Vueåº”ç”¨HTMLå†…å®¹å¯èƒ½æœ‰é—®é¢˜', 'warning');
                        log('âš ï¸ Vueåº”ç”¨HTMLå†…å®¹å¯èƒ½æœ‰é—®é¢˜');
                    }
                })
                .catch(error => {
                    addStatus('âŒ Vueåº”ç”¨è¿æ¥å¤±è´¥: ' + error.message, 'error');
                    log('âŒ Vueåº”ç”¨è¿æ¥å¤±è´¥: ' + error.message);
                });
        }

        function testElementPlus() {
            log('ğŸ§ª æµ‹è¯•Element Plusèµ„æº...');
            
            // æµ‹è¯•Element Plus CSS
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'http://localhost:5173/node_modules/element-plus/dist/index.css';
            link.onload = () => {
                addStatus('âœ… Element Plus CSS åŠ è½½æˆåŠŸ', 'success');
                log('âœ… Element Plus CSS åŠ è½½æˆåŠŸ');
            };
            link.onerror = () => {
                addStatus('âŒ Element Plus CSS åŠ è½½å¤±è´¥', 'error');
                log('âŒ Element Plus CSS åŠ è½½å¤±è´¥');
            };
            document.head.appendChild(link);
        }

        function testRouter() {
            log('ğŸ§ª æµ‹è¯•è·¯ç”±åŠŸèƒ½...');
            
            const routes = ['/', '/enterprise', '/candidate', '/reports'];
            
            routes.forEach(route => {
                fetch(`http://localhost:5173${route}`)
                    .then(response => {
                        if (response.ok) {
                            addStatus(`âœ… è·¯ç”± ${route} å“åº”æ­£å¸¸`, 'success');
                            log(`âœ… è·¯ç”± ${route} å“åº”æ­£å¸¸`);
                        } else {
                            addStatus(`âŒ è·¯ç”± ${route} å“åº”å¼‚å¸¸: ${response.status}`, 'error');
                            log(`âŒ è·¯ç”± ${route} å“åº”å¼‚å¸¸: ${response.status}`);
                        }
                    })
                    .catch(error => {
                        addStatus(`âŒ è·¯ç”± ${route} è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                        log(`âŒ è·¯ç”± ${route} è¿æ¥å¤±è´¥: ${error.message}`);
                    });
            });
        }

        function testAPI() {
            log('ğŸ§ª æµ‹è¯•APIè¿æ¥...');
            
            // æµ‹è¯•å¼€å‘æœåŠ¡å™¨API
            fetch('http://localhost:5173/api/health')
                .then(response => {
                    if (response.ok) {
                        addStatus('âœ… APIå¥åº·æ£€æŸ¥é€šè¿‡', 'success');
                        log('âœ… APIå¥åº·æ£€æŸ¥é€šè¿‡');
                    } else {
                        addStatus('âš ï¸ APIå¥åº·æ£€æŸ¥è¿”å›é200çŠ¶æ€', 'warning');
                        log('âš ï¸ APIå¥åº·æ£€æŸ¥è¿”å›é200çŠ¶æ€: ' + response.status);
                    }
                })
                .catch(error => {
                    addStatus('âš ï¸ APIå¥åº·æ£€æŸ¥å¤±è´¥ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼Œå¦‚æœæ²¡æœ‰åç«¯APIï¼‰', 'warning');
                    log('âš ï¸ APIå¥åº·æ£€æŸ¥å¤±è´¥: ' + error.message);
                });
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æ£€æŸ¥
        window.addEventListener('load', () => {
            log('ğŸš€ æµè§ˆå™¨è¯Šæ–­å·¥å…·å·²å¯åŠ¨');
            runBasicChecks();
        });

        // æ•è·æœªå¤„ç†çš„é”™è¯¯
        window.addEventListener('error', (event) => {
            addStatus('âŒ JavaScripté”™è¯¯: ' + event.message, 'error');
            log('âŒ JavaScripté”™è¯¯: ' + event.message + ' åœ¨ ' + event.filename + ':' + event.lineno);
        });

        // æ•è·Promiseæ‹’ç»
        window.addEventListener('unhandledrejection', (event) => {
            addStatus('âŒ æœªå¤„ç†çš„Promiseæ‹’ç»: ' + event.reason, 'error');
            log('âŒ æœªå¤„ç†çš„Promiseæ‹’ç»: ' + event.reason);
        });
    </script>
</body>
</html>
